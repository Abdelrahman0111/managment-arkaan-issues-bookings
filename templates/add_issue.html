{% extends "base.html" %}

{% block content %}
<div class="content-card">
    <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
    <form id="issueForm" class="mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„</label>
                    <select class="form-select" id="agent_name" required>
                        {% for agent in agents %}
                        <option>{{ agent }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²</label>
                    <input type="text" class="form-control" id="booking_number" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">ğŸ’° Ø§Ù„Ø®ØµÙ…</label>
                    <input type="number" class="form-control" id="discount" value="0" step="0.01">
                </div>
                <div class="mb-3">
                    <label class="form-label">ğŸ“Œ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
                    <select class="form-select" id="issue_type">
                        <option>Ù…Ø´ÙƒÙ„Ø© Ø¨Ø³ÙŠØ·Ø©</option>
                        <option>Ù…Ø´ÙƒÙ„Ø© Ù…ØªÙˆØ³Ø·Ø©</option>
                        <option>Ù…Ø´ÙƒÙ„Ø© ÙƒØ¨ÙŠØ±Ø©</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">ğŸ’³ Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹</label>
                    <select class="form-select" id="payment_type" onchange="toggleMonthlyAmount()">
                        <option value="ÙƒÙ„ÙŠ">Ø¯ÙØ¹ ÙƒÙ„ÙŠ</option>
                        <option value="Ø¬Ø²Ø¦ÙŠ">Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ (Ø£Ù‚Ø³Ø§Ø·)</option>
                    </select>
                </div>
                <div class="mb-3" id="monthly_amount_div" style="display:none;">
                    <label class="form-label">ğŸ“… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                    <input type="number" class="form-control" id="monthly_amount" value="0" step="0.01">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">ğŸ“… ØªØ§Ø±ÙŠØ® ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
                    <input type="date" class="form-control" id="check_in" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">ğŸ“… ØªØ§Ø±ÙŠØ® ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</label>
                    <input type="date" class="form-control" id="check_out" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <textarea class="form-control" id="notes" rows="5"></textarea>
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary btn-lg w-100">âœ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleMonthlyAmount() {
    const paymentType = document.getElementById('payment_type').value;
    const monthlyDiv = document.getElementById('monthly_amount_div');
    monthlyDiv.style.display = paymentType === 'Ø¬Ø²Ø¦ÙŠ' ? 'block' : 'none';
}

document.getElementById('issueForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const data = {
        agent_name: document.getElementById('agent_name').value,
        booking_number: document.getElementById('booking_number').value,
        discount: document.getElementById('discount').value,
        notes: document.getElementById('notes').value,
        check_in: document.getElementById('check_in').value,
        check_out: document.getElementById('check_out').value,
        issue_type: document.getElementById('issue_type').value,
        payment_type: document.getElementById('payment_type').value,
        monthly_amount: document.getElementById('monthly_amount').value
    };
    
    const response = await fetch('/add_issue', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });
    
    if (response.ok) {
        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        location.reload();
    }
});
</script>
{% endblock %}
